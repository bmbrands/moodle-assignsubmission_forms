define("assignsubmission_forms/forms",["exports","core/templates","core/str","./repository","jquery","core/utils"],(function(_exports,_templates,_str,_repository,_jquery,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module forms
   *
   * @module     assignsubmission_forms/forms
   * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>, Jonas Rehkopp <jonas.rehkopp@polizei.nrw.de>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_repository=_interopRequireDefault(_repository),_jquery=_interopRequireDefault(_jquery);class Forms{constructor(){this.rootElement=document.querySelector(".forms-form"),this.init()}async init(){this.rootElement.querySelectorAll("textarea").forEach((async textarea=>{const areaid=textarea.dataset.fieldid+"-wordcounter",statusid=textarea.dataset.fieldid+"-status",count=textarea.value.split(/\s+/).filter((word=>word.length>0)).length,{html:html,js:js}=await _templates.default.renderForPromise("assignsubmission_forms/fieldactions",{areaid:areaid,statusid:statusid,count:count});_templates.default.appendNodeContents(textarea.parentNode,html,js)})),this.addValidationClassesToInput(),this.bindEvents()}addValidationClassesToInput(){const setValidationState=element=>{""===element.value.trim()?element.classList.add("is-invalid"):element.classList.remove("is-invalid")},handleFocusOut=element=>{element.classList.add("needs-validation","was-validated"),setValidationState(element)},handleFocus=element=>{element.classList.remove("needs-validation","was-validated"),setValidationState(element)},handleKeyUp=element=>{setValidationState(element)};this.rootElement.querySelectorAll("input").forEach((input=>{input.hasAttribute("aria-required")&&(input.addEventListener("focusout",(()=>handleFocusOut(input))),input.addEventListener("focus",(()=>handleFocus(input))),input.addEventListener("keyup",(()=>handleKeyUp(input))))}));this.rootElement.querySelectorAll("textarea").forEach((textarea=>{textarea.hasAttribute("aria-required")&&(textarea.addEventListener("focusout",(()=>handleFocusOut(textarea))),textarea.addEventListener("focus",(()=>handleFocus(textarea))),textarea.addEventListener("keyup",(()=>handleKeyUp(textarea))))}))}async bindEvents(){const textareas=this.rootElement.querySelectorAll("textarea"),inputs=this.rootElement.querySelectorAll('input[type="text"]'),checkboxes=this.rootElement.querySelectorAll('input[type="checkbox"]'),dateSelectors=this.rootElement.querySelectorAll("select"),saveDraftDebounce=(0,_utils.debounce)(this.saveDraft,2e3);textareas.forEach((async textarea=>{textarea.addEventListener("input",(async event=>{const wordCounter=document.getElementById(event.target.dataset.fieldid+"-wordcounter"),count=event.target.value.split(/\s+/).filter((word=>word.length>0)).length;wordCounter.innerHTML=await(0,_str.getString)("words","assignsubmission_forms",count),saveDraftDebounce(event.target)}))})),inputs.forEach((async input=>{input.addEventListener("input",(async event=>{saveDraftDebounce(event.target)}))})),checkboxes.forEach((async checkbox=>{checkbox.addEventListener("input",(async event=>{saveDraftDebounce(event.target)}))})),dateSelectors.forEach((async dateSelector=>{dateSelector.addEventListener("input",(async event=>{saveDraftDebounce(event.target)}))})),document.addEventListener("click",(async event=>{const popOvers=document.querySelectorAll('[data-toggle="popover"]'),currentPopover=event.target.closest('[data-toggle="popover"]');popOvers.length>0&&popOvers.forEach((popover=>{popover!==currentPopover&&(0,_jquery.default)(popover).popover("hide")}))}))}async saveDraft(field){const rootElement=document.querySelector(".forms-form"),assignmentid=rootElement.querySelector('input[name="instanceid"]').value,fieldid=field.name.match(/\[(\d+)\]/)[1];let value=field.value;if(field.name.includes("[day]")||field.name.includes("[month]")||field.name.includes("[year]")){const day=rootElement.querySelector('select[name="forms['.concat(fieldid,'][day]"]')).value,month=rootElement.querySelector('select[name="forms['.concat(fieldid,'][month]"]')).value,year=rootElement.querySelector('select[name="forms['.concat(fieldid,'][year]"]')).value;value=new Date(year,month-1,day).getTime()/1e3}const data={assignmentid:parseInt(assignmentid),fieldid:parseInt(fieldid),value:value};await _repository.default.storeDraft(data)}}var _default={init:()=>{new Forms}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=forms.min.js.map